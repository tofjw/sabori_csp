% TSP instance: n=8, bound=314
% Distance matrix (flattened, 1-based index: dist_flat[i*n + j + 1] = dist[i][j])

array [1..64] of int: dist_flat = [0, 5, 37, 90, 98, 19, 60, 48, 5, 0, 86, 90, 13, 59, 77, 64, 37, 86, 0, 78, 3, 66, 56, 74, 90, 90, 78, 0, 48, 80, 71, 97, 98, 13, 3, 48, 0, 56, 51, 23, 19, 59, 66, 80, 56, 0, 8, 14, 60, 77, 56, 71, 51, 8, 0, 16, 48, 64, 74, 97, 23, 14, 16, 0];

var 0..7: next_0 :: output_var;
var 0..7: next_1 :: output_var;
var 0..7: next_2 :: output_var;
var 0..7: next_3 :: output_var;
var 0..7: next_4 :: output_var;
var 0..7: next_5 :: output_var;
var 0..7: next_6 :: output_var;
var 0..7: next_7 :: output_var;

var 3..98: edge_cost_0;
var 3..98: edge_cost_1;
var 3..98: edge_cost_2;
var 3..98: edge_cost_3;
var 3..98: edge_cost_4;
var 3..98: edge_cost_5;
var 3..98: edge_cost_6;
var 3..98: edge_cost_7;

var 1..8: idx_0;
var 9..16: idx_1;
var 17..24: idx_2;
var 25..32: idx_3;
var 33..40: idx_4;
var 41..48: idx_5;
var 49..56: idx_6;
var 57..64: idx_7;

var 24..314: total_cost :: output_var;

constraint circuit([next_0, next_1, next_2, next_3, next_4, next_5, next_6, next_7]);

% Index constraints: idx_i = next_i + i*n + 1
constraint int_lin_eq([1, -1], [next_0, idx_0], -1);
constraint int_lin_eq([1, -1], [next_1, idx_1], -9);
constraint int_lin_eq([1, -1], [next_2, idx_2], -17);
constraint int_lin_eq([1, -1], [next_3, idx_3], -25);
constraint int_lin_eq([1, -1], [next_4, idx_4], -33);
constraint int_lin_eq([1, -1], [next_5, idx_5], -41);
constraint int_lin_eq([1, -1], [next_6, idx_6], -49);
constraint int_lin_eq([1, -1], [next_7, idx_7], -57);

% Edge cost constraints: edge_cost_i = dist_flat[idx_i]
constraint array_int_element(idx_0, dist_flat, edge_cost_0);
constraint array_int_element(idx_1, dist_flat, edge_cost_1);
constraint array_int_element(idx_2, dist_flat, edge_cost_2);
constraint array_int_element(idx_3, dist_flat, edge_cost_3);
constraint array_int_element(idx_4, dist_flat, edge_cost_4);
constraint array_int_element(idx_5, dist_flat, edge_cost_5);
constraint array_int_element(idx_6, dist_flat, edge_cost_6);
constraint array_int_element(idx_7, dist_flat, edge_cost_7);

% Total cost constraint
constraint int_lin_eq([1, 1, 1, 1, 1, 1, 1, 1, -1], [edge_cost_0, edge_cost_1, edge_cost_2, edge_cost_3, edge_cost_4, edge_cost_5, edge_cost_6, edge_cost_7, total_cost], 0);

solve minimize total_cost;
